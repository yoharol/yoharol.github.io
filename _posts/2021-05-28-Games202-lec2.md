---
layout: post
tag: note
categories: blog
title: "Note: Lagrangian View and Eulerian View"
mathjax: true
---

拉格朗日 随波逐流 
Langrangian View: sensors that move passively with the simulated material
"What are my position and velocity?"
Mostly particle physics, position based. Every particle has position and velocity.

欧拉视角 岿然不动
Eulerian View: sensors that never move
"What is the material velocity passing by?"
Mostly 

Mass spring system 

$$\begin{align*}
\vec{f_{ij}}&=-k(||\vec{x}_i-\vec{x}_j||_2 - l_{ij})(\widehat{\vec{x}_i-\vec{x}_j})\\
\vec{f}_i&=\sum^{j\neq i}_j\vec{f}_{ij}\\
\frac{\partial\vec{v}_i}{\partial t}&=\frac{1}{m_i}\vec{f_i}\\
\frac{\vec{x}_i}{\partial t}&=\vec{v}_i
\end{align*}$$

$k$:spring stiffness; $l_{ij}$: spring rest length between particle i and particle j;

To calculate, we have two ways to do it.

1. Forward Euler(explicit)

   $$\begin{align*}
   \vec{v}_{t+1}&=\vec{v}_t + \Delta t\frac{\vec{f}_t}{m}\\
   \vec{x}_{t+1}&=\vec{x}_t + \Delta t\vec{v}_t
   \end{align*}$$
   
2. Semi-implicit Euler(aka. symplectic Euler, explicit, commonly used)

   $$\begin{align*}
   \vec{v}_{t+1}&=\vec{v}_t + \Delta t\frac{\vec{f}_t}{m}\\
   \vec{x}_{t+1}&=\vec{x}_t + \Delta t\vec{v}_{t+1}
   \end{align*}$$

3. Backward Euler(often with Newton's method, implicit)

   $$\begin{align*}
   \vec{x}_{t+1}&=\vec{x}_t + \Delta t\vec{v_{t+1}}\\
   \vec{v}_{t+1}&=\vec{v}_t + \Delta t M^{-1}\vec{f}(\vec{x}_{t+1})
   \end{align*}$$
   
   Eliminate $\vec{x}_{t+1}$:
   
   $$\vec{v}_{t+1} = \vec{v}_t + \Delta t M^{-1}f(\vec{x}_t + \Delta t\vec{v}_{t+1})$$
   
   Linearize(one step of Newton's method):
   
   $$\vec{v}_{t+1}=\vec{v}_t + \Delta t M^{-1}[\vec{f}{x_t} + \frac{\partial f}{\partial x}(x_t)\Delta t \vec{v}_{t+1}]$$

Explicit:

- Future depends only on past

- Easy to implement

- Easy to explode:

  $$\Delta t\leq c\sqrt{\frac{m}{k}}(c\sim 1)$$

- Bad for stiff materials(k is too large)

The updating frequency should allow the system to get close to steady situation. Imagine a mass spring that the stiffness is too large, so the next frame the whole system already move past the steady point and get much far away from the steady situation, then the whole system will "explode".

Implicit:

- Future depends on both future and past
- Need to solve a system of (linear) equations
- In general harder to implement
- Each step is more expensive but time steps are larger
- Numerical damping and locking.

