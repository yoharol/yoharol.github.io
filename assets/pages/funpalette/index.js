function add_color(){const e=document.createElement("div");color_list.appendChild(e);var r="#42445A";pickr_list.length>0&&(r=pickr_list[pickr_list.length-1].get_color());var t=new ColorPoint(e,r);pickr_list.push(t)}function remove_color(){pickr_list.length>0&&(pickr_list[pickr_list.length-1].remove_element(),pickr_list.splice(pickr_list.length-1,1))}function init_scene(){canvas=document.querySelector(".webgl");const e={width:.5*window.innerWidth,height:.5*window.innerHeight};renderer=new THREE.WebGL1Renderer({canvas:canvas,antialias:!0}),renderer.setSize(e.width,e.height),renderer.setPixelRatio(window.devicePixelRatio),renderer.setClearColor(1513251,1),renderer.shadowMap.enabled=!0,document.body.appendChild(renderer.domElement),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(50,e.width/e.height,1,1e3),camera.position.set(180,120,-90),camera.lookAt(0,0,0),scene.add(camera),controls=new OrbitControls(camera,renderer.domElement)}function updateColorPoint(){pointArr.splice(0,pointArr.length),colors.splice(0,colors.length);for(let e=0;e<pickr_list.length;e++){pointArr.push(pickr_list[e].LAB[0],pickr_list[e].LAB[1],pickr_list[e].LAB[2]);const r=pickr_list[e].pickr._color.toRGBA();colors.push(r[0]/255,r[1]/255,r[2]/255)}}function fun(e,r,t,o,i,n){if(r==(1<<e|1))return o[e][r]=n[0][e],i[e][r]=0,n[0][e];if(-1!=o[e][r])return o[e][r];var l=10**9,a=0;for(let s=0;s<t;s++){if(r&1<<s&&s!=e&&0!=s)var c=fun(s,r&~(1<<e),t,o,i,n)+n[s][e];c<l&&(l=c,a=s)}return o[e][r]=l,i[e][r&~(1<<e)]=a,l}function reorder(){var e=pickr_list.length,r=[],t=[],o=new Array(e);for(let t=0;t<e;t++){r.push(pickr_list[t].get_color()),o[t]=new Array(e);for(let r=0;r<e;r++)o[t][r]=t==r?0:LAB_Distance(pickr_list[t].LAB,pickr_list[r].LAB)}let i=new Array(e),n=new Array(e);for(let r=0;r<e;r++)i[r]=new Array(1<<e),i[r].fill(-1),n[r]=new Array(1<<e),n[r].fill(-1);var l=10**9,a=(1<<e)-1;for(let r=0;r<e;r++){(u=fun(r,a,e,i,n,o)+o[r][0])<l&&(l=u,i[0][a]=l,n[0][a]=r)}a=(1<<e)-1;for(var c=0,s=[0];1!=a;){var p=n[c][a];s.push(p),a&=~(1<<p),c=p}var d=o[s[0]][s[1]],m=0;for(let r=1;r<e;r++){var u;(u=r<e-1?o[s[r]][s[r+1]]:o[s[r]][s[0]])>d&&(d=u,m=r)}var w=m+1;for(w>=e&&(w=0);w!=m;)t.push(s[w]),(w+=1)>=e&&(w=0);t.push(s[m]);for(let e=0;e<pickr_list.length;e++)pickr_list[e].set_color(r[t[e]])}function animate(){requestAnimationFrame(animate),updateColorPoint(),lineGeometry.setColors(colors),lineGeometry.setPositions(pointArr),lineGeometry._maxInstanceCount=pickr_list.length-1,line.computeLineDistances(),pointGeometry.setAttribute("position",new THREE.BufferAttribute(new Float32Array(pointArr),3)),pointGeometry.setAttribute("color",new THREE.Float32BufferAttribute(new Float32Array(colors),3)),renderer.render(scene,camera)}import*as THREE from"three";import{OrbitControls}from"OrbitControls";import{Line2}from"line2";import{LineMaterial}from"lineMaterial";import{LineGeometry}from"lineGeometry";var cover=document.querySelector(".cover");let canvas,camera,scene,renderer,controls;cover.parentNode.removeChild(cover);const sprite=(new THREE.TextureLoader).load("sprite.png");init_scene();const color_list=document.querySelector(".colorlist");var pickr_list=[],pointArr=[],colors=[];add_color(),updateColorPoint();var lineGeometry=new LineGeometry;lineGeometry.setPositions(pointArr),lineGeometry.setColors(colors);var lineMaterial=new LineMaterial({color:16777215,linewidth:5,vertexColors:!0});lineMaterial.resolution.set(window.innerWidth,window.innerHeight);var line=new Line2(lineGeometry,lineMaterial);line.computeLineDistances(),scene.add(line);var pointGeometry=new THREE.BufferGeometry;pointGeometry.setAttribute("position",new THREE.BufferAttribute(new Float32Array(pointArr),3)),pointGeometry.setAttribute("color",new THREE.Float32BufferAttribute(new Float32Array(colors),3)),pointGeometry.dynamic;const pointMaterial=new THREE.PointsMaterial({size:20,sizeAttenuation:!0,map:sprite,transparent:!0,vertexColors:!0}),pointCloud=new THREE.Points(pointGeometry,pointMaterial);scene.add(pointCloud),document.getElementById("add").onclick=add_color,document.getElementById("sub").onclick=remove_color,document.getElementById("reorder").onclick=reorder,animate();